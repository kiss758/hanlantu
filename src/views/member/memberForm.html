<div class="layui-form" lay-filter="layuiadmin-form-member" style="padding: 20px 30px 0 0">
  <div class="layui-row layui-col-space10">
    <input type="hidden" name="id" autocomplete="off" class="layui-input" value="" />
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">手机号:</label>
        <div class="layui-input-inline">
          <input type="text" name="phone" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">姓名:</label>
        <div class="layui-input-inline">
          <input type="text" name="name" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">其他方式:</label>
        <div class="layui-input-inline">
          <input type="text" name="other_contact" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">出生日期:</label>
        <div class="layui-input-inline">
          <input type="text" name="birth" class="layui-input" id="birth" placeholder="yyyy-MM-dd" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">客户类型:</label>
        <div class="layui-input-inline">
          <select name="customer_type" id="customertype_name" lay-verify="validatecustomer_type"></select>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">QQ号码:</label>
        <div class="layui-input-inline">
          <input type="text" name="qq_number" id="qq_number" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">性别:</label>
        <div class="layui-input-inline">
          <select name="gender" id="gender">
            <option value="">未知</option>
            <option value="女">女</option>
            <option value="男">男</option>
          </select>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">拓客时间:
          <dt>必填</dt>
        </label>
        <div class="layui-input-inline">
          <input type="text" class="layui-input" name="topcustomer_date" id="topcustomer_date" placeholder="yyyy-MM-dd"
            lay-verify="required|validatecustomer_time" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">微信号:
          <dt>必填</dt>
        </label>
        <div class="layui-input-inline">
          <input type="text" name="wechat" id="wechat" lay-verify="required|validatewechat" autocomplete="off"
            class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">客户来源:
          <dt>必填</dt>
        </label>
        <div class="layui-input-inline">
          <select name="customer_source" id="customer_source" lay-verify="required|validatecustomer_source"></select>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">推广人:
          <dt>必填</dt>
        </label>
        <div class="layui-input-inline">
          <select name="recommenders" id="recommenders" lay-verify="required|validaterecommenders"></select>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label" style="min-width: 84px;">
          归属(微信号):
          <dt>必填</dt>
        </label>
        <div class="layui-input-inline">
          <select name="belonging_id" id="belonging_id_two" lay-verify="required|validatebelonging_id"></select>
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label">城市:</label>
        <div class="layui-input-inline">
          <input type="text" name="wechat_city" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md12">
      <div class="layui-form-item" id="bioarea-wrap">
        <label class="layui-form-label  required">请选择地区</label>
        <div class="layui-input-inline">
          <select lay-filter="province" name="province" id="province">
            <option value="">请选择省</option>
          </select>
        </div>
        <div class="layui-input-inline">
          <select lay-filter="city" name="city" id="city">
            <option value="">请选择市</option>
          </select>
        </div>
        <div class="layui-input-inline">
          <select lay-filter="district" name="district" id="district">
            <option value="">请选择</option>
          </select>
        </div>
      </div>
    </div>
    <div class="layui-col-md12">
      <div class="layui-form-item">
        <label class="layui-form-label">详细地址:</label>
        <div class="layui-input-block">
          <input type="text" name="customer_detailed_address" id="customer_detailed_address"
            placeholder="详情地址只需要填入 详细住址,不需要全部的地址" autocomplete="off" class="layui-input" />
        </div>
      </div>
    </div>
    <div class="layui-col-md12">
      <div class="layui-form-item">
        <label class="layui-form-label">备注:</label>
        <div class="layui-input-block">
          <input type="text" name="notes" id="notes" autocomplete="off" class="layui-input" value="" />
        </div>
      </div>
    </div>
    <div class="layui-col-md4">
      <div class="layui-form-item">
        <label class="layui-form-label"></label>
        <div class="layui-input-inline">
          <input type="button" lay-submit lay-filter="LAY-user-member-submit" value="确认" class="layui-btn" />
        </div>
      </div>
    </div>
  </div>
</div>

<style lang="less">
  .layui-form-label {
    text-align: center;
  }

  .layui-form-label dt {
    color: red;
  }
</style>
<script>
  layui.use(["admin", "form", "laydate"], function () {
    let $ = layui.$,
      form = layui.form,
      admin = layui.admin,
      laydate = layui.laydate;

    laydate.render({
      elem: "#topcustomer_date",
    });
    laydate.render({
      elem: "#birth",

    });

    $(".layui-btn").click(function () {
      var phone = $("input[name='phone']").val(); //客户手机
      var name = $("input[name='name']").val(); //客户姓名
      var customer_type = $("select[name='customer_type']").val(); //客户类型
      var province = $("select[name='province']").val(); //省
      var city = $("select[name='city']").val(); //市
      var district = $("select[name='district']").val(); //区
      var customer_detailed_address = $("input[name='customer_detailed_address']").val(); //详细地址

      if (phone !== "") {
        if (name === "") { layer.msg("请完善客户姓名!"); return; }
        if (customer_type === "") { layer.msg("请完善客户类型!"); return; }
        if (province === "") { layer.msg("请完善省!"); return; }
        if (city === "") { layer.msg("请完善市!"); return; }
        if (district === "") { layer.msg("请完善区!"); return; }
        if (customer_detailed_address === "") { layer.msg("请完善详细地址!"); return; }
      }


    });

    function editUserForm(id) {
      if (id == undefined || id == "") {
        return false;
      }
      admin.req({
        moduleurl: "Member/edit",
        async: false,
        data: { id: id },
        done: (res) => {
          const {
            id,
            name,
            phone,
            other_contact,
            birth,
            customer_type,
            qq_number,
            gender,
            topcustomer_date,
            wechat,
            customer_source,
            recommenders,
            belonging_id,
            wechat_city,
            province,
            city,
            district,
            customer_detailed_address,
            notes,
            founder_time,
            allow_modifiable,
          } = res.data;
          $("input[name='id']").val(id);
          $("input[name='phone']").val(phone);
          $("input[name='name']").val(name);
          $("input[name='other_contact']").val(other_contact);
          $("input[name='birth']").val(birth);
          $("select[name='customer_type']").val(customer_type);
          $("input[name='qq_number']").val(qq_number);
          $("select[name='gender']").val(gender);
          $("input[name='topcustomer_date']").val(topcustomer_date);
          $("input[name='wechat']").val(wechat);
          $("select[name='customer_source']").val(customer_source);
          $("select[name='recommenders']").val(recommenders);
          $("select[name='belonging_id']").val(belonging_id);
          $("input[name='wechat_city']").val(wechat_city);
          // 省市县
          $("select[name='province']").val(province);
          $("select[name='city']").html(
            `<option value='${city}'>${city}</option>`
          );
          $("select[name='district']").html(
            `<option value='${district}'>${district}</option>`
          );
          $("input[name='customer_detailed_address']").val(
            customer_detailed_address
          ); // 详细地址
          $("input[name='notes']").val(notes);

          if (allow_modifiable !== 0) {
            $("select[name='customer_source']").attr("disabled", true);
            $("select[name='belonging_id']").attr("disabled", true);
            $("select[name='recommenders']").attr("disabled", true);
            $("input[name='wechat']").attr("disabled", true);
            $("input[name='topcustomer_date']").attr("disabled", true);
            if (phone !== "") {
              $("input[name='phone']").attr("disabled", true);
            }
          }

          form.render("select");
        },
      });
    }

    layui.data.sendParams = function (params) {
      params = params;
      editUserForm(params.id);
    };

    $(() => {
      admin.req({
        moduleurl: "Member/add",
        data: {},
        async: false,
        done: (res) => {
          let customertype_name = '<option value="" selected="">未知</option>';
          let customer_source = '<option value="" selected="">未知</option>';
          let recommenders = '<option value="" selected="">未知</option>';
          let belonging_id = '<option value="" selected="">未知</option>';
          const {
            Customertype_list,
            Customersource_list,
            Recommenders_list,
            User_list,
          } = res.data;

          Customertype_list.map((item) => {
            customertype_name += `<option value="${item.customertype_name}">${item.customertype_name}</option>`;
          });
          Customersource_list.map((item) => {
            customer_source += `<option value="${item.customersource_name}">${item.customersource_name}</option>`;
          });
          Recommenders_list.map((item) => {
            recommenders += `<option value="${item.recommenders}">${item.recommenders}</option>`;
          });
          User_list.map((item) => {
            belonging_id += `<option value="${item.ID}">${item.Username}</option>`;
          });
          $("#customertype_name").html(customertype_name);
          $("#customer_source").html(customer_source);
          $("#recommenders").html(recommenders);
          $("#belonging_id_two").html(belonging_id);

          const memberinfo = JSON.parse(window.sessionStorage.getItem("memberinfo"))
          if (memberinfo) {
            $("select[name='recommenders']").val(memberinfo.recommenders);
            $("select[name='customer_source']").val(memberinfo.customer_source);
            // $("select[name='belonging_id']").val(memberinfo.belonging_id);
            $("input[name='topcustomer_date']").val(memberinfo.topcustomer_date)
          }

          form.render("select");
        },
      });
    });
  });
</script>
<script src="/start/js/area.js"></script>
<script src="/start/js/select.js"></script>
<script type="text/html" template lay-done="layui.data.sendParams(d.params)"></script>